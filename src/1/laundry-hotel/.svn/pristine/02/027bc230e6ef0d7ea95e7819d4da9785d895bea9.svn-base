@{
    Layout = null;
}

<link href="@Url.Content("~/Content/ReportStyle.css")" rel="stylesheet" />
<link media="print" href="@Url.Content("~/Content/ReportStyle.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/plugins/datapicker/datepicker3.css")" rel="stylesheet" />

<div style="top:130px;margin-left:-15px; padding-left:0;padding-right:0;width:100%; position:fixed;z-index:2030;">
    <div style="width:100%;padding: 2px;background: #f7f7f7;z-index: 1;border: 1px solid #dadada;display: table;clear: both;content:''">
        <div style="float: left;border-left: 1px solid #dedcdc;margin-right: 8px;margin-left: 8px;">
            <div onclick="conditonChange()" role="button" title="过滤" style="border-color:#ccc;border-radius:2px;cursor:pointer;line-height:36px;margin:0 1px;min-width:30px;padding:0 6px;position:relative;user-select:none;text-align:center;">
                <span class="fa fa-filter" style="font-size:16px;margin-top:1px;opacity:0.8;"></span>
            </div>
        </div>
        <div style="float: left;border-left: 1px solid #dedcdc;margin-right: 8px;margin-left: 8px;">
            <div role="button" onclick="myPrint()" title="打印" data-state="" style="border-color:#ccc;border-radius:2px;display:inline-block;cursor:pointer;line-height:36px;margin:0 1px;min-width:30px;padding:0 6px;position:relative;user-select:none;text-align:center;">
                <span class="fa fa-print" style="font-size:16px;margin-top:1px;opacity:0.8;"></span>
            </div>
            <div style="display:inline-block;position:relative;">
                <form id="formExport" action="@Url.Action("RSDailyExportExcel","Summary")" method="post">
                    <div disabled="disabled" id="btnExportExcel" title="导出" data-state="" style="border-color:#ccc;border-radius:2px;display:inline-block;cursor:pointer;line-height:36px;margin:0 1px;min-width:30px;padding:0 6px;position:relative;user-select:none;text-align:center;">
                        <span class="fa fa-floppy-o" style="font-size:16px;margin-top:1px;opacity:0.8;"></span>
                    </div>
                    <input type="hidden" id="hddTitle" name="hddTitle" value="" />
                    <input type="hidden" id="hddData" name="hddData" value="" />
                    <input type="hidden" id="hddCondition" name="hddCondition" value="" />
                    <input type="hidden" id="hddpx" name="hddpx" value="11" />
                </form>
            </div>
            <div role="button" title="分享" data-state="" style="border-color:#ccc;border-radius:2px;display:inline-block;cursor:pointer;line-height:36px;margin:0 1px;min-width:30px;padding:0 6px;position:relative;user-select:none;text-align:center;">
                <span class="fa fa-share-alt"></span>
            </div>
        </div>
    </div>
</div>
<div id="conditonPanel" style="position: fixed;top: 172px;float:left;width:250px;background-color:#F1F1F1;height:100%;margin-left:-15px;">
    <div style="padding:20px 10px;">
        <div class="form-group">
            <span class="conditionTitle">酒店：</span>
        </div>
        <div class="form-group">
            <select class="form-control" id="hotelId">
                @{
                    var hotelList = ViewData["HotelList"] as List<ETexsys.Model.region>;
                    if (hotelList.Count > 0)
                    {
                        <option value="0">所有</option>
                    }
                    foreach (var item in hotelList)
                    {
                        <option value="@item.ID">@item.RegionName</option>
                    }
                }
            </select>
        </div>
        <div class="form-group">
            <span class="conditionTitle">时间：</span>
        </div>
        <div class="form-group">
            <div class="input-group" style="">
                <input type="text" class="form-control" id="dateTime" value="" />
                <span class="input-group-addon">
                    <i class="fa fa-calendar bigger-110"></i>
                </span>
            </div>
        </div>
        <div class="form-group">
            <span class="conditionTitle">管理方式：</span>
        </div>
        <div class="form-group">
            <div class="input-group" style="float: left">
                <div class="checkbox" style="">
                    <label>
                        <input name="CusArea" type="checkbox" class="ace" value="1" checked="checked" />
                        <span class="lbl">租赁</span>
                    </label>
                </div>
            </div>
            <div class="input-group" style="float: left;margin-left:16px;">
                <div class="checkbox" style="">
                    <label>
                        <input name="CusArea" type="checkbox" class="ace" value="2" />
                        <span class="lbl">非租赁</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="form-group">
            <button id="btnSearch" type="button" class="btn btn-success" style="width:230px;height:35px;"><i class="fa fa-search"></i>查询</button>
        </div>
    </div>
</div>
<div id="dc" class="row wrapper animated fadeInRight" style="overflow-x:auto;background: #FFF;padding-left:0;padding-right:0;width:calc(100% - 220px);float:right;margin-top:110px;">
    <div id="print">
        <span id="title" style="font-size:24px;font-family:'Microsoft YaHei';font-weight:bold;margin:20px 0px 0 0; display:inline-block;">收发统计表</span>
        <div id="condition" style="margin-left:20px;">
            <div id="leftConditon" style="float:left;"></div>
            <div id="rightConditon" style="float:right;"></div>
        </div>
        <table id="dataReport" style="border-collapse: collapse;font-size:14px;font-family:'Microsoft YaHei';color:#333;margin:20px;" cellpadding="0" cellspacing="0"></table>
    </div>
</div>
<script src="@Url.Content("~/Scripts/plugins/datapicker/bootstrap-datepicker.js")"></script>
<script src="@Url.Content("~/Scripts/plugins/datapicker/bootstrap-datepicker.zh-CN.js")"></script>
<script src="@Url.Content("~/Scripts/jquery-migrate-1.2.1.min.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.jqprint-0.3.js")"></script>
<script src="@Url.Content("~/Scripts/table_row_col_span.js")"></script>
<script>
    // 对Date的扩展，将 Date 转化为指定格式的String
    // 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，
    // 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)
    // 例子：
    // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
    // (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18
    Date.prototype.format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    $("#dc").height(document.body.clientHeight - 180);

    $(document.body).css({
        "overflow-y": "hidden"
    });

    window.onresize = function () {
        $("#dc").height(document.body.clientHeight - 180);

        $(document.body).css({
            "overflow-y": "hidden"
        });
    }

    function conditonChange() {
        if ($("#conditonPanel").is(":hidden")) {
            $("#dc").css("width", "calc(100% - 220px)");
            $("#conditonPanel").show();
        } else {
            $("#dc").css("width", "100%");
            $("#conditonPanel").hide();
        }
    }

    $(document).ready(function () {
        var d = new Date();
        $('#dateTime').val(d.format("yyyy-MM-dd"));

        $('#dateTime').datepicker({
            language: "zh-CN",
            autoclose: true,//选中之后自动隐藏日期选择框
            clearBtn: false,//清除按钮
            todayBtn: false,//今日按钮
            format: "yyyy-mm-dd",//日期格式
            endDate: new Date(),
        }).on('show', function (e) {
            $(".datepicker").css("z-Index", "2100");
        });
    });

    function ResponsibleOnChange() {
        if ($("#Responsible").val() == "1") {
            $("#hotelId").attr("disabled", "disabled");
        } else {
            $("#hotelId").removeAttr("disabled");
        }
    }

    $("#btnSearch").on("click", function () {
        if ($("#dateTime").val() == "") {
            swal("提示", "请选择时间.");
            return;
        }
        if ($(".checkbox input:checked").length == 0) {
            swal("提示", "请选择管理方式.");
            return;
        }

        var type = -1;
        var chks = $(".checkbox input:checked");
        if (!!chks && chks.length == 2) {
            type = 0;
        } else {
            type = $(chks[0]).val();
        }

        var _url = "@Url.Action("RSDailyQuery", "Summary")";
        $.ajax({
            type: "post",
            data: {
                hotelId: $("#hotelId").val(), time: $("#dateTime").val(), type: type
            },
            url: _url,
            success: function (result) {
                $("#title").html($("#dateTime").val() + $("#hotelId").find("option:selected").text() + "收发统计表");
                $("#dataReport").empty();
                var item, it, table, thread, tr;
                for (var i = 0; i < result.length; i++) {
                    item = result[i];
                    $("#dataReport").append("客户名称：" + item.ShortName + "<br/>");
                    $("#dataReport").append("时间：" + item.CreateTime + "<br/>");
                    //table table-bordered table-hover
                    table = $("<table></table>").addClass("table").addClass("table-bordered").addClass("table-hover");
                    tr = $("<tr></tr>");
                    $("<td style='text-align:left;'>编号</td>").appendTo(tr);
                    $("<td style='text-align:left;'>品名</td>").appendTo(tr);
                    $("<td style='text-align:right;'>正常</td>").appendTo(tr);
                    $("<td style='text-align:right;'>重污</td>").appendTo(tr);
                    $("<td style='text-align:right;'>返洗</td>").appendTo(tr);
                    $("<td style='text-align:right;'>过水</td>").appendTo(tr);
                    $("<td style='text-align:right;'>发货</td>").appendTo(tr);
                    $(table).append(tr);

                    for (var j = 0; j < item.Data.length; j++) {
                        it = item.Data[j];
                        tr = $("<tr></tr>");
                        $("<td>" + it.Code + "</td>").appendTo(tr);
                        $("<td style='text-align:left;padding-right:5px;'>" + it.TextileName + "</td>").appendTo(tr);
                        $("<td style='text-align:right;padding-left:0px;padding-right:5px;'>" + it.Normal + "</td>").appendTo(tr);
                        $("<td style='text-align:right;padding-left:0px;padding-right:5px;'>" + it.Dirty + "</td>").appendTo(tr);
                        $("<td style='text-align:right;padding-left:0px;padding-right:5px;'>" + it.BackWash + "</td>").appendTo(tr);
                        $("<td style='text-align:right;padding-left:0px;padding-right:5px;'>" + it.GuoShui + "</td>").appendTo(tr);
                        $("<td style='text-align:right;padding-left:0px;padding-right:5px;'>" + it.SendCount + "</td>").appendTo(tr);
                        $(table).append(tr);
                    }

                    $("#dataReport").append(table);
                }

                _w_table_rowspan("#dataReport", 1);
                _w_table_rowspan("#dataReport", 2);
                _w_table_colspan("#dataReport", result.length, 3);

                var totalwidth = 800;
                var dtWidth = totalwidth < 500 ? 500 : totalwidth;
                $("#title").css("margin-left", ((dtWidth - 230) / 2).toString() + "px");
                $("#dataReport").css("width", dtWidth);
                $("#condition").css("width", dtWidth);
                $("#print").css("width", dtWidth + 50);
                $("#leftConditon").html("酒店：" + $("#hotelId").find("option:selected").text());
                $("#rightConditon").html("时间：" + $("#dateTime").val());

                $("#hddCondition").val($("#leftConditon").text() + "|" + $("#rightConditon").text());
                $("#hddTitle").val($("#dateTime").val() + $("#hotelId").find("option:selected").text() + "收发统计表");
                $("#hddData").val(JSON.stringify(result));

                $("#btnExportExcel").removeAttr("disabled");
            }
        });
    });

    $("#btnSearch").click();

    $("#btnExportExcel").on("click", function () {
        document.getElementById("formExport").submit();
    });

    function myPrint(obj) {
        $("#print").jqprint({
        });
    }

</script>

