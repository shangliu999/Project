@{
    Layout = null;
}
@model ETexsys.WebApplication.Areas.Dashboard.Models.DashboardBaseModel

<style>
    .btntime {
        background-color: #FFF;
        color: #000;
        padding: 5px 15px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: normal;
    }

        .btntime:hover {
            background-color: #0294DD;
            color: #fff;
        }

    .btntimeclick {
        background-color: #0294DD;
        color: #fff;
    }
</style>
<script src="@Url.Content("~/Scripts/echarts.min.js")"></script>
<div class="row wrapper wrapper-content animated fadeInRight" style="padding-top:100px;padding-left:20px;">
    <div class="row">
        <div class="col-lg-6">
            <div class="row">
                <div class="col-lg-6">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                            <img style="float:left;" src="@Url.Content("~/Images/icon-jiudian.png")" />
                            <h5 style="padding-top:5px; margin-left:5px;font-weight:normal;font-size:16px; color:#666;">服务酒店（家）</h5>
                        </div>
                        <div class="ibox-content" style="text-align:center;border-width: 0 0;border-radius:0 0 4px 4px ;">
                            <h1 class="no-margins" style="font-size:30px; color:#333;">@Model.HotelTotal</h1>
                            <div style="margin-top:10px;padding:5px 0; background-color:#F3F3F4;color:#FA8305; border-radius:15px;font-size:14px;">本月新增<text>@Model.CurrentMonthHotelTotal</text>家</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                            <img style="float:left;" src="@Url.Content("~/Images/icon-shouru.png")" />
                            <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;font-size:16px; color:#666;">本月收入（元）</h5>
                        </div>
                        <div class="ibox-content" style="text-align:center;border-width: 0 0;border-radius:0 0 4px 4px ;">
                            <h1 class="no-margins" style="font-size:30px; color:#333;">￥@Model.InCome.ToString("N2")</h1>
                            <div style="margin-top:10px;padding:5px 0; background-color:#F3F3F4;color:#FF6F9F; border-radius:15px;">上月收入：￥@Model.PreInCome.ToString("N2")</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                            <img style="float:left;" src="@Url.Content("~/Images/icon-bucao.png")" />
                            <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;font-size:16px; color:#666;">布草数量（件）</h5>
                        </div>
                        <div class="ibox-content" style="text-align:center;border-width: 0 0;border-radius:0 0 4px 4px ;">
                            <h1 class="no-margins" style="font-size:30px; color:#333;">@Model.TextileTotal.ToString("N0")</h1>
                            <div style="margin-top:10px;padding:5px 0; background-color:#F3F3F4;color:#21AF37;font-size:14px; border-radius:15px;">60天未使用：@Model.AbnormalTextileTotal.ToString("N0")</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                            <img style="float:left;" src="@Url.Content("~/Images/icon-jaiziche.png")" />
                            <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;font-size:16px; color:#666;">架子车（辆）</h5>
                        </div>
                        <div class="ibox-content" style="text-align:center;border-width: 0 0;border-radius:0 0 4px 4px ;">
                            <h1 class="no-margins" style="font-size:30px; color:#333;">@Model.TruckTotal.ToString("N0")</h1>
                            <div style="margin-top:10px;padding:5px 0; background-color:#fff;color:#43BB43; border-radius:15px;">&nbsp;</div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                            <img style="float:left;" src="@Url.Content("~/Images/icon-bao.png")" />
                            <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;font-size:16px; color:#666;">包（个）</h5>
                        </div>
                        <div class="ibox-content" style="text-align:center;border-width: 0 0;border-radius:0 0 4px 4px ;">
                            <h1 class="no-margins" style="font-size:30px; color:#333;">@Model.BagTotal.ToString("N0")</h1>
                            <div style="margin-top:10px;padding:5px 0; background-color:#fff;color:#43BB43; border-radius:15px;">&nbsp;</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="ibox float-e-margins">
                <div class="ibox float-e-margins">
                    <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                        <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;">芯片报废统计</h5>

                        <span class="label label-primary pull-right btntime" data-type="scrap" onclick="loadScrapData(2,this)">本年</span>
                        <span class="label label-primary pull-right btntime btntimeclick" data-type="scrap" onclick="loadScrapData(1,this)">本月</span>
                    </div>
                    <div class="ibox-content" style="text-align:center;border-radius:0 0 4px 4px ; height:285px;">
                        <div id="scrapMChart" style="width:100%;height:280px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-5">
            <div class="ibox float-e-margins">
                <div class="ibox float-e-margins">
                    <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                        <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;">布草分布统计</h5>
                    </div>
                    <div class="ibox-content" style="text-align:center;border-radius:0 0 4px 4px ; height:285px;">
                        <div id="cDisChart" style="width:50%;height:280px;float:left;"></div>
                        <div id="jDisChart" style="width:50%;height:280px;float:left;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-7">
            <div class="ibox float-e-margins">
                <div class="ibox float-e-margins">
                    <div class="ibox-title" style="border-width:0;border-radius:4px 4px 0 0 ;">
                        <h5 style="padding-top:5px; margin-left:5px;color:#828282;font-family:'Microsoft YaHei UI';font-weight:normal;">布草洗涤统计</h5>

                        <span class="label label-primary pull-right btntime" data-type="washing" onclick="loadWashingChat(2,this)">近一月</span>
                        <span class="label label-primary pull-right btntime btntimeclick" data-type="washing" onclick="loadWashingChat(1,this)">近一周</span>
                    </div>
                    <div class="ibox-content" style="text-align:center;border-radius:0 0 4px 4px ; height:285px;">
                        <div id="washingMChart" style="width:100%;height:280px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function loadScrapData(type, obj) {
        var url = "@Url.Action("ScrapChatData", "Factory")";
        $.ajax({
            type: "post",
            data: { type: type },
            url: url,
            async: false,
            success: function (result) {
                if (result.ResultCode == "0") {
                    $(".btntime[data-type='scrap']").removeClass("btntimeclick");
                    $(obj).addClass("btntimeclick");
                    var xdata = result.Result.ClassName;
                    var ydata1 = result.Result.ScrapTotal;
                    var ydata2 = result.Result.ABScrapTotal;

                    var scrapm_dom = document.getElementById("scrapMChart");
                    var scrapMChart = echarts.init(scrapm_dom);
                    scrapm_option = {

                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['报废总数', '异常报废'],
                        },
                        toolbox: {
                            show: false,
                            feature: {
                                mark: { show: true },
                                dataView: { show: true, readOnly: false },
                                magicType: { show: true, type: ['line', 'bar'] },
                                restore: { show: true },
                                saveAsImage: { show: true }
                            }
                        },
                        calculable: true,
                        xAxis: [
                            {
                                type: 'category',
                                data: xdata
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                show: true
                            }
                        ],
                        series: [
                            {
                                name: '报废总数',
                                type: 'bar',
                                data: ydata1,
                                itemStyle: {
                                    normal: {
                                        color: function (params) {
                                            // build a color map as your need.
                                            var colorList = [
                                              '#2497FB'
                                            ];
                                            return colorList[params.dataIndex]
                                        }
                                    }, emphasis: {
                                        color: "#2497FB"
                                    }
                                }
                            },
                            {
                                name: '异常报废',
                                type: 'bar',
                                data: ydata2,
                                itemStyle: {
                                    normal: {
                                        color: function (params) {
                                            // build a color map as your need.
                                            var colorList = [
                                              '#FF492D'
                                            ];
                                            return colorList[params.dataIndex]
                                        }
                                    }, emphasis: {
                                        color: "#FF492D"
                                    }
                                }
                            }
                        ]
                    };
                    scrapMChart.setOption(scrapm_option, true);
                } else {

                }
            }
        });
    }

    loadScrapData(1, $(".btntimeclick[data-type='scrap']"));

    function loadTextileDistribution() {
        var textile_url = "@Url.Action("TextileDistrbution", "Factory")";
        $.ajax({
            type: "post",
            url: textile_url,
            async: false,
            success: function (result) {
                if (result.ResultCode == "0") {
                    var data = result.Result;
                    if (data.length > 0) {
                        var cdata = data[0];

                        var cDisChart_dom = document.getElementById("cDisChart");
                        var cDisChart = echarts.init(cDisChart_dom);

                        cDisChart_option = {
                            title: {
                                text: cdata.CateName,
                                x: 'center',
                                y: 'center',
                                itemGap: 20,
                                textStyle: {
                                    color: 'rgba(30,144,255,0.8)',
                                    fontFamily: '微软雅黑',
                                    fontSize: 25,
                                    fontWeight: 'bolder'
                                }
                            },
                            color: ['#21AF37', '#FF6B9D', '#FAB305', '#2497FB', '#FF492D'],
                            tooltip: {
                                trigger: 'item',
                                formatter: "{a} <br/>{b} : {c} ({d}%)"
                            },
                            legend: {
                                orient: 'vertical',
                                x: 'left',
                                data: cdata.LegendList
                            },
                            toolbox: {
                                show: false,
                                feature: {
                                    mark: { show: true },
                                    dataView: { show: true, readOnly: false },
                                    magicType: {
                                        show: true,
                                        type: ['pie', 'funnel'],
                                        option: {
                                            funnel: {
                                                x: '25%',
                                                width: '50%',
                                                funnelAlign: 'center'
                                            }
                                        }
                                    },
                                    restore: { show: true },
                                    saveAsImage: { show: true }
                                }
                            },
                            calculable: true,
                            series: [
                                {
                                    name: cdata.CateName,
                                    type: 'pie',
                                    radius: ['50%', '70%'],
                                    itemStyle: {
                                        normal: {
                                            label: {
                                                show: false
                                            },
                                            labelLine: {
                                                show: false
                                            }
                                        }
                                    },
                                    data: cdata.TextileData
                                }
                            ]
                        };

                        cDisChart.setOption(cDisChart_option, true);
                    }
                    if (data.length > 1) {
                        var jDisChart_dom = document.getElementById("jDisChart");
                        var jDisChart = echarts.init(jDisChart_dom);
                        var jdata = data[1];
                        jDisChart_option = {
                            title: {
                                text: jdata.CateName,
                                x: 'center',
                                y: 'center',
                                itemGap: 20,
                                textStyle: {
                                    color: 'rgba(30,144,255,0.8)',
                                    fontFamily: '微软雅黑',
                                    fontSize: 25,
                                    fontWeight: 'bolder'
                                }
                            },
                            color: ['#21AF37', '#FF6B9D', '#FAB305', '#2497FB', '#FF492D'],
                            tooltip: {
                                trigger: 'item',
                                formatter: "{a} <br/>{b} : {c} ({d}%)"
                            },
                            legend: {
                                show: false,
                                x: 'left',
                                data: jdata.LegendList
                            },
                            toolbox: {
                                show: false,
                                feature: {
                                    mark: { show: true },
                                    dataView: { show: true, readOnly: false },
                                    magicType: {
                                        show: true,
                                        type: ['pie', 'funnel'],
                                        option: {
                                            funnel: {
                                                x: '25%',
                                                width: '50%',
                                                funnelAlign: 'center'
                                            }
                                        }
                                    },
                                    restore: { show: true },
                                    saveAsImage: { show: true }
                                }
                            },
                            calculable: true,
                            series: [
                                {
                                    name: jdata.CateName,
                                    type: 'pie',
                                    radius: ['50%', '70%'],
                                    itemStyle: {
                                        normal: {
                                            label: {
                                                show: false
                                            },
                                            labelLine: {
                                                show: false
                                            }
                                        }
                                    },
                                    data: jdata.TextileData
                                }
                            ]
                        };

                        jDisChart.setOption(jDisChart_option, true);
                    }
                } else {

                }
            }
        });
    }

    loadTextileDistribution();

    function loadWashingChat(type, obj) {
        var url = "@Url.Action("WashingData", "Factory")";
        $.ajax({
            type: "post",
            data: { type: type },
            url: url,
            async: false,
            success: function (result) {
                if (result.ResultCode == "0") {
                    var data = result.Result;
                    var s = [];
                    debugger;
                    if (result.Result.Series.length == 1) {
                        s.push({
                            name: result.Result.Series[0].name,
                            type: 'line',
                            yAxisIndex: 1,
                            data: result.Result.Series[0].data,
                            lineWidth: 15,
                            itemStyle: {
                                normal: {
                                    lineStyle: {
                                        color: '#FAB305'
                                    }
                                }
                            },
                        });
                    } else if (result.Result.Series.length == 2) {
                        s.push({
                            name: result.Result.Series[0].name,
                            type: 'bar',
                            yAxisIndex: 0,
                            barWidth: 25,//固定柱子宽度
                            data: result.Result.Series[0].data,
                            itemStyle: {
                                normal: {
                                    color: function (params) {
                                        // build a color map as your need.
                                        var colorList = [
                                          '#0294DD'
                                        ];
                                        return colorList[params.dataIndex]
                                    }
                                }
                            }
                        });

                        s.push({
                            name: result.Result.Series[1].name,
                            type: 'line',
                            yAxisIndex: 1,
                            data: result.Result.Series[1].data,
                            barWidth: 25,//固定柱子宽度
                            itemStyle: {
                                normal: {
                                    lineStyle: {
                                        color: '#FAB305'
                                    }
                                }
                            },
                        });
                    } else if (result.Result.Series.length == 3) {
                        s.push({
                            name: result.Result.Series[0].name,
                            type: 'bar',
                            yAxisIndex: 0,
                            barWidth: 25,//固定柱子宽度
                            data: result.Result.Series[0].data,
                            itemStyle: {
                                normal: {
                                    color: function (params) {
                                        // build a color map as your need.
                                        var colorList = [
                                          '#0294DD'
                                        ];
                                        return colorList[params.dataIndex]
                                    }
                                }
                            }
                        });

                        s.push({
                            name: result.Result.Series[1].name,
                            type: 'bar',
                            barWidth: 25,//固定柱子宽度
                            yAxisIndex: 0,
                            data: result.Result.Series[0].data,
                            itemStyle: {
                                normal: {
                                    color: function (params) {
                                        // build a color map as your need.
                                        var colorList = [
                                          '#21AF37'
                                        ];
                                        return colorList[params.dataIndex]
                                    }
                                }
                            }
                        });

                        s.push({
                            name: result.Result.Series[2].name,
                            type: 'line',
                            yAxisIndex: 1,
                            data: result.Result.Series[2].data,
                            barWidth: 25,//固定柱子宽度
                            itemStyle: {
                                normal: {
                                    lineStyle: {
                                        color: '#FAB305'
                                    }
                                }
                            },
                        });
                    }

                    $(".btntime[data-type='washing']").removeClass("btntimeclick");
                    $(obj).addClass("btntimeclick");
                    var washingMChart_dom = document.getElementById("washingMChart");
                    var washingMChart = echarts.init(washingMChart_dom);

                    washingMChart_option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        toolbox: {
                            show: false,
                            feature: {
                                mark: { show: true },
                                dataView: { show: true, readOnly: false },
                                magicType: { show: true, type: ['line', 'bar'] },
                                restore: { show: true },
                                saveAsImage: { show: true }
                            }
                        },
                        calculable: true,
                        legend: {
                            data: data.LegendList,
                        },
                        xAxis: [
                            {
                                type: 'category',
                                data: data.xAxis
                            }
                        ],

                        yAxis: [
                            {
                                type: 'value',
                                name: '洗涤数'
                            },
                            {
                                type: 'value',
                                name: '返洗率',
                                axisLabel: {
                                    show: true,
                                    interval: 'auto',
                                    formatter: '{value}%'
                                },
                            }
                        ],
                        series: s
                    };

                    washingMChart.setOption(washingMChart_option, true);
                } else {

                }
            }
        });
    }


    loadWashingChat(1, $(".btntimeclick[data-type='washing']"));
</script>